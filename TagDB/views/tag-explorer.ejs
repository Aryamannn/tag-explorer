<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("partials/head.ejs") %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      let dragged;
      document.addEventListener("DOMContentLoaded", () => {
      const draggables = document.querySelectorAll(".draggable");
      const dropzone = document.getElementById("dropzone");

      draggables.forEach(draggable => {
      draggable.addEventListener("dragstart", (event) => {
        dragged = event.target;
        event.target.classList.add("dragging");
      });

      draggable.addEventListener("dragend", (event) => {
        event.target.classList.remove("dragging");
        });
      });

      dropzone.addEventListener("dragover", (event) => {
        event.preventDefault(); // Allow drop
      });

      dropzone.addEventListener("dragenter", (event) => {
        event.target.classList.add("dragover");
      });

      dropzone.addEventListener("dragleave", (event) => {
        event.target.classList.remove("dragover");
      });

      dropzone.addEventListener("drop", (event) => {
        event.preventDefault();
        event.target.classList.remove("dragover");
        if (dragged) {
          const draggedText = dragged.textContent.trim();
          const existingTags = Array.from(dropzone.getElementsByClassName("tag-badge"));
          const tagExists = existingTags.some(tag => tag.id === draggedText);

          if (!tagExists) {
            const newTag = document.createElement("span");
            newTag.className = "tag-badge";
            newTag.id = draggedText;
            newTag.textContent = draggedText;
            const closeBtn = document.createElement("span");
            closeBtn.className = "close-btn";
            closeBtn.textContent = "Ã—";
            closeBtn.onclick = () => newTag.remove();

            newTag.appendChild(closeBtn);
            dropzone.querySelector('.tag-container').appendChild(newTag);
          } else {
            alert("This tag is already added!");
          }
        }
        });
      });
    </script>
</head>
<body>

  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <div class="row">
        <div class="col-12">
            <header class="p-3" style="background-color: #f8f9fa;">
                <h1 class="text-left">Tag Explorer</h1>
            </header>
        </div>
    </div>

    <div class="row">
        <div class="col-3 sidebar p-3">
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Dropdown
                </a>
                <ul class="dropdown-menu">
                  <% tags.forEach(tag => { %>
                    <li class="nav-item dropdown dropend">
                        <a class="dropdown-item dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <%= tag.tag_name || 'Untitled Tag' %>
                        </a>
                        <ul class="dropdown-menu">
                            <% if (tag.tag_values && tag.tag_values.length > 0) { %>
                                <% tag.tag_values.forEach(value => { %>
                                    <li><a class="dropdown-item draggable" href="#" draggable="true"><%= value.tag_value %></a></li>
                                <% }); %>
                            <% } else { %>
                                <li><a href="#">No values</a></li>
                            <% } %>
                        </ul>
                    </li>
                <% }); %>
                </ul>
              </li>
        </div>

        <div class="col-9 p-3">
          <div class="top-box" style="display: flex; align-items: center;">
            <div class="filter-tags" id="dropzone">
              <div class="tag-container">
                  <span class="tag-badge">Tags</span>
                  
              </div>
            </div>
            <div class="icon-buttons" style="margin-left: 10px;">
              <img src="/images/x_symbol.png" alt="X symbol" />
              <img src="/images/plus_symbol.png" alt="Plus symbol" />
              <img src="/images/gear_symbol.png" alt="Gear symbol" />
            </div>
          </div>
          <div class="file-list">
            <div class="file-list-header row">
              <div class="col-4">File Name</div>
              <div class="col-3">Date Modified</div>
              <div class="col-3">Type</div>
              <div class="col-2">Size</div>
            </div>
            <div class="file-item row">
              <div class="col-4">File1.pdf</div>
              <div class="col-3">10/2/2024</div>
              <div class="col-3">PDF File</div>
              <div class="col-2">45 KB</div>
            </div>
            <div class="file-item row active">
              <div class="col-4">File2.txt</div>
              <div class="col-3">10/1/2024</div>
              <div class="col-3">Text Document</div>
              <div class="col-2">2 KB</div>
            </div>
            <div class="file-item row">
              <div class="col-4">File3.xlsx</div>
              <div class="col-3">9/29/2024</div>
              <div class="col-3">Microsoft Excel Workbook</div>
              <div class="col-2">10 KB</div>
            </div>
            <div class="file-item row">
              <div class="col-4">File4.exe</div>
              <div class="col-3">8/12/2024</div>
              <div class="col-3">Application</div>
              <div class="col-2">691 KB</div>
            </div>
          </div>
        </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.js"></script>

</body>
</html>
